# AIå®¢æœç³»ç»Ÿ - è¿ç»´éƒ¨ç½²å‘½ä»¤å¤§å…¨

> ç®€æ´å®ç”¨çš„è¿ç»´éƒ¨ç½²å‘½ä»¤å‚è€ƒæ‰‹å†Œ

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [Docker éƒ¨ç½²](#docker-éƒ¨ç½²)
- [æ•°æ®åº“æ“ä½œ](#æ•°æ®åº“æ“ä½œ)
- [æœåŠ¡ç®¡ç†](#æœåŠ¡ç®¡ç†)
- [æ—¥å¿—æŸ¥çœ‹](#æ—¥å¿—æŸ¥çœ‹)
- [å¤‡ä»½æ¢å¤](#å¤‡ä»½æ¢å¤)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [å¸¸ç”¨åœºæ™¯](#å¸¸ç”¨åœºæ™¯)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### é¦–æ¬¡éƒ¨ç½²

```bash
# 1. å…‹éš†ä»£ç 
git clone <repository-url>
cd game-ai

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡

# 3. å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆDocker ä¼šè‡ªåŠ¨åˆå§‹åŒ–æ•°æ®åº“ï¼‰
docker-compose up -d --build

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### ä¸€é”®åˆå§‹åŒ–ï¼ˆLinux/Macï¼‰

```bash
chmod +x scripts/init-db.sh
./scripts/init-db.sh
```

### ä¸€é”®åˆå§‹åŒ–ï¼ˆWindowsï¼‰

```powershell
.\scripts\init-db.ps1
```

---

## ğŸ³ Docker éƒ¨ç½²

### åŸºç¡€å‘½ä»¤

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
docker-compose up -d

# å¯åŠ¨å¹¶é‡æ–°æ„å»ºé•œåƒ
docker-compose up -d --build

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆâš ï¸ ä¼šåˆ é™¤æ•°æ®ï¼‰
docker-compose down -v

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f postgres
docker-compose logs -f redis
```

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨å•ä¸ªæœåŠ¡
docker-compose up -d postgres
docker-compose up -d redis
docker-compose up -d backend

# åœæ­¢å•ä¸ªæœåŠ¡
docker-compose stop backend
docker-compose stop postgres

# é‡å¯æœåŠ¡
docker-compose restart backend
docker-compose restart all

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build backend
```

### å¼€å‘æ¨¡å¼

```bash
# ä½¿ç”¨å¼€å‘é…ç½®ï¼ˆçƒ­é‡è½½ï¼‰
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d --build
```

### å®¹å™¨æ“ä½œ

```bash
# è¿›å…¥å®¹å™¨
docker-compose exec backend sh
docker-compose exec postgres psql -U postgres -d game_ai_cs

# æ‰§è¡Œå®¹å™¨å†…å‘½ä»¤
docker-compose exec backend npm run db:generate
docker-compose exec backend prisma migrate deploy

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect game-ai-cs-backend
```

---

## ğŸ’¾ æ•°æ®åº“æ“ä½œ

### Prisma å‘½ä»¤

```bash
# ç”Ÿæˆ Prisma Client
cd backend
npx prisma generate
# æˆ–ä½¿ç”¨ npm è„šæœ¬
npm run db:generate

# åˆ›å»ºæ–°çš„è¿ç§»
npx prisma migrate dev --name migration_name

# éƒ¨ç½²è¿ç§»ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
npx prisma migrate deploy
# æˆ–ä½¿ç”¨ npm è„šæœ¬
npm run db:migrate:deploy

# æŸ¥çœ‹è¿ç§»çŠ¶æ€
npx prisma migrate status

# é‡ç½®æ•°æ®åº“ï¼ˆâš ï¸ ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
npx prisma migrate reset

# æ‰“å¼€ Prisma Studioï¼ˆæ•°æ®åº“å¯è§†åŒ–ï¼‰
npx prisma studio
# æˆ–ä½¿ç”¨ npm è„šæœ¬
npm run db:studio
```

### æ•°æ®åº“è¿æ¥

```bash
# é€šè¿‡ Docker è¿æ¥ PostgreSQL
docker-compose exec postgres psql -U postgres -d game_ai_cs

# æ‰§è¡Œ SQL æŸ¥è¯¢
docker-compose exec -T postgres psql -U postgres -d game_ai_cs -c "SELECT COUNT(*) FROM \"Ticket\";"

# å¤‡ä»½æ•°æ®åº“
docker-compose exec -T postgres pg_dump -U postgres game_ai_cs > backup_$(date +%Y%m%d_%H%M%S).sql

# æ¢å¤æ•°æ®åº“
docker-compose exec -T postgres psql -U postgres -d game_ai_cs < backup.sql
```

### ç§å­æ•°æ®

```bash
# åˆå§‹åŒ–ç§å­æ•°æ®
cd backend
npx prisma db seed
# æˆ–ä½¿ç”¨ npm è„šæœ¬
npm run db:seed

# è·³è¿‡ç§å­æ•°æ®ï¼ˆè®¾ç½®ç¯å¢ƒå˜é‡ï¼‰
SKIP_SEED=true docker-compose up -d
```

---

## ğŸ”§ æœåŠ¡ç®¡ç†

### åç«¯æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
cd backend
npm run start:dev

# ç”Ÿäº§æ¨¡å¼
npm run start:prod

# æ„å»º
npm run build

# æ¸…ç†æ„å»ºæ–‡ä»¶
npm run clean:build
```

### å‰ç«¯æœåŠ¡

```bash
# ç©å®¶ç«¯å¼€å‘
cd frontend/player-app
npm run dev

# ç®¡ç†ç«¯å¼€å‘
cd frontend/admin-portal
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

### æœåŠ¡å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥åç«¯ API
curl http://localhost:21101/api/v1/health
curl http://localhost:21101/api/v1/docs

# æ£€æŸ¥å‰ç«¯
curl http://localhost:20101
curl http://localhost:20102
```

---

## ğŸ“Š æ—¥å¿—æŸ¥çœ‹

### Docker æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker-compose logs --tail=100

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f postgres
docker-compose logs -f redis

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose logs backend | grep -i error
```

### åº”ç”¨æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—æ–‡ä»¶
tail -f backend/logs/backend-$(date +%Y-%m-%d).log
tail -f backend/logs/backend-$(date +%Y-%m-%d).error.log

# æŸ¥çœ‹æœ€è¿‘é”™è¯¯
grep -i error backend/logs/backend-*.log | tail -20

# æ¸…ç†æ—¥å¿—
cd backend
npm run clean:logs

# å½’æ¡£æ—¥å¿—
npm run archive:logs
```

### Redis æ—¥å¿—

```bash
# è¿æ¥ Redis
docker-compose exec redis redis-cli

# æŸ¥çœ‹ Redis ä¿¡æ¯
docker-compose exec redis redis-cli INFO

# æŸ¥çœ‹æ‰€æœ‰ Key
docker-compose exec redis redis-cli KEYS "*"

# æ¸…ç©º Redisï¼ˆâš ï¸ è°¨æ…ä½¿ç”¨ï¼‰
docker-compose exec redis redis-cli FLUSHALL
```

---

## ğŸ’¿ å¤‡ä»½æ¢å¤

### æ•°æ®åº“å¤‡ä»½

```bash
# å®Œæ•´å¤‡ä»½
docker-compose exec -T postgres pg_dump -U postgres game_ai_cs > backup_$(date +%Y%m%d_%H%M%S).sql

# ä»…å¤‡ä»½æ•°æ®ï¼ˆä¸å«ç»“æ„ï¼‰
docker-compose exec -T postgres pg_dump -U postgres -a game_ai_cs > backup_data_$(date +%Y%m%d_%H%M%S).sql

# ä»…å¤‡ä»½ç»“æ„ï¼ˆä¸å«æ•°æ®ï¼‰
docker-compose exec -T postgres pg_dump -U postgres -s game_ai_cs > backup_schema_$(date +%Y%m%d_%H%M%S).sql

# å‹ç¼©å¤‡ä»½
docker-compose exec -T postgres pg_dump -U postgres game_ai_cs | gzip > backup_$(date +%Y%m%d_%H%M%S).sql.gz
```

### æ•°æ®åº“æ¢å¤

```bash
# æ¢å¤å®Œæ•´å¤‡ä»½
docker-compose exec -T postgres psql -U postgres -d game_ai_cs < backup.sql

# æ¢å¤å‹ç¼©å¤‡ä»½
gunzip < backup.sql.gz | docker-compose exec -T postgres psql -U postgres -d game_ai_cs

# æ¢å¤åˆ°æ–°æ•°æ®åº“
docker-compose exec -T postgres psql -U postgres -c "CREATE DATABASE game_ai_cs_restore;"
docker-compose exec -T postgres psql -U postgres -d game_ai_cs_restore < backup.sql
```

### æ–‡ä»¶å¤‡ä»½

```bash
# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf uploads_backup_$(date +%Y%m%d_%H%M%S).tar.gz backend/uploads/

# æ¢å¤ä¸Šä¼ æ–‡ä»¶
tar -xzf uploads_backup_*.tar.gz -C backend/

# å¤‡ä»½æ—¥å¿—æ–‡ä»¶
tar -czf logs_backup_$(date +%Y%m%d_%H%M%S).tar.gz backend/logs/
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### æœåŠ¡çŠ¶æ€æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps

# æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶æ€
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# æ£€æŸ¥å®¹å™¨èµ„æºä½¿ç”¨
docker stats --no-stream

# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network ls
docker network inspect game-ai-cs-network
```

### å¸¸è§é—®é¢˜æ’æŸ¥

```bash
# 1. æœåŠ¡æ— æ³•å¯åŠ¨
docker-compose logs backend | tail -50
docker-compose exec backend sh  # è¿›å…¥å®¹å™¨æ£€æŸ¥

# 2. æ•°æ®åº“è¿æ¥å¤±è´¥
docker-compose exec postgres pg_isready -U postgres
docker-compose logs postgres | tail -50

# 3. Redis è¿æ¥å¤±è´¥
docker-compose exec redis redis-cli ping
docker-compose logs redis | tail -50

# 4. ç«¯å£è¢«å ç”¨
# Linux/Mac
lsof -i :21101
lsof -i :20101
lsof -i :20102

# Windows
netstat -ano | findstr :21101
netstat -ano | findstr :20101

# 5. æŸ¥çœ‹ç¯å¢ƒå˜é‡
docker-compose exec backend env | grep -E "(DATABASE|REDIS|JWT)"

# 6. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
docker system df
```

### é‡ç½®æœåŠ¡

```bash
# å®Œå…¨é‡ç½®ï¼ˆâš ï¸ ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
docker-compose down -v
docker-compose up -d --build

# ä»…é‡ç½®åç«¯æœåŠ¡
docker-compose stop backend
docker-compose rm -f backend
docker-compose up -d --build backend
```

---

## ğŸ¯ å¸¸ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ›´æ–°ä»£ç å¹¶é‡æ–°éƒ¨ç½²

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. åœæ­¢æœåŠ¡
docker-compose down

# 3. é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# 4. è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚æœæœ‰æ–°è¿ç§»ï¼‰
docker-compose exec backend npx prisma migrate deploy

# 5. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
docker-compose logs -f backend
```

### åœºæ™¯2ï¼šæ·»åŠ æ–°çš„æ•°æ®åº“è¿ç§»

```bash
# 1. åˆ›å»ºè¿ç§»æ–‡ä»¶
cd backend
npx prisma migrate dev --name add_new_feature

# 2. æäº¤è¿ç§»æ–‡ä»¶åˆ° Git
git add prisma/migrations/
git commit -m "feat: add new database migration"

# 3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¿ç§»
docker-compose exec backend npx prisma migrate deploy
```

### åœºæ™¯3ï¼šæŸ¥çœ‹æœåŠ¡æ€§èƒ½

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹æ•°æ®åº“è¿æ¥æ•°
docker-compose exec postgres psql -U postgres -d game_ai_cs -c "SELECT count(*) FROM pg_stat_activity;"

# æŸ¥çœ‹ Redis å†…å­˜ä½¿ç”¨
docker-compose exec redis redis-cli INFO memory

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—ä¸­çš„é”™è¯¯
docker-compose logs backend | grep -i error | tail -20
```

### åœºæ™¯4ï¼šæ¸…ç†èµ„æº

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker image prune -a

# æ¸…ç†æœªä½¿ç”¨çš„å®¹å™¨
docker container prune

# æ¸…ç†æœªä½¿ç”¨çš„å·ï¼ˆâš ï¸ è°¨æ…ä½¿ç”¨ï¼‰
docker volume prune

# æ¸…ç†æ‰€æœ‰æœªä½¿ç”¨çš„èµ„æº
docker system prune -a

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
cd backend
npm run clean:logs
```

### åœºæ™¯5ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥æ¸…å•

```bash
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡
cat .env | grep -E "(JWT_SECRET|DATABASE_URL|REDIS)" | grep -v "^#"

# 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps

# 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker-compose exec backend npx prisma migrate status

# 4. æ£€æŸ¥ API å¥åº·
curl http://localhost:21101/api/v1/docs

# 5. æ£€æŸ¥å‰ç«¯è®¿é—®
curl http://localhost:20101
curl http://localhost:20102

# 6. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker-compose logs backend | grep -i error | tail -10
```

---

## ğŸ“ ç¯å¢ƒå˜é‡é…ç½®

### å¿…éœ€é…ç½®

```env
# æ•°æ®åº“
DATABASE_URL="postgresql://user:password@host:port/db?schema=public&connection_limit=50"

# JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET="your-strong-secret-key-here"
JWT_EXPIRES_IN="7d"

# å‰ç«¯åœ°å€
FRONTEND_URL="http://your-domain:20101,http://your-domain:20102"
```

### å¯é€‰é…ç½®

```env
# æœåŠ¡ç«¯å£
PORT=21101
HOST=0.0.0.0

# Redis
REDIS_HOST=redis
REDIS_PORT=6379

# ç™¾åº¦ç¿»è¯‘
BAIDU_TRANSLATE_APP_ID="your-app-id"
BAIDU_TRANSLATE_SECRET="your-secret"

# Dify AI
DIFY_API_KEY="your-api-key"
DIFY_BASE_URL="https://api.dify.ai"

# åŠ å¯†å¯†é’¥
ENCRYPTION_SECRET_KEY="your-32-char-secret-key-here!!"
```

---

## ğŸ” å®‰å…¨å»ºè®®

```bash
# 1. ä¿®æ”¹é»˜è®¤å¯†ç 
# ç™»å½•ç³»ç»Ÿåç«‹å³ä¿®æ”¹æ‰€æœ‰é»˜è®¤è´¦æˆ·å¯†ç 

# 2. ä½¿ç”¨å¼º JWT å¯†é’¥
# ç”Ÿæˆéšæœºå¯†é’¥
openssl rand -base64 32

# 3. é™åˆ¶æ•°æ®åº“è®¿é—®
# ä»…å…è®¸åº”ç”¨æœåŠ¡å™¨è®¿é—®æ•°æ®åº“

# 4. å®šæœŸå¤‡ä»½
# è®¾ç½®å®šæ—¶ä»»åŠ¡è‡ªåŠ¨å¤‡ä»½
0 2 * * * docker-compose exec -T postgres pg_dump -U postgres game_ai_cs > /backup/db_$(date +\%Y\%m\%d).sql

# 5. ç›‘æ§æ—¥å¿—
# å®šæœŸæ£€æŸ¥é”™è¯¯æ—¥å¿—
grep -i "error\|exception" backend/logs/*.log | tail -50
```

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### æœ€å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# åœæ­¢æœåŠ¡
docker-compose down

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# é‡å¯æœåŠ¡
docker-compose restart backend

# è¿›å…¥å®¹å™¨
docker-compose exec backend sh

# æ•°æ®åº“è¿ç§»
docker-compose exec backend npx prisma migrate deploy

# æŸ¥çœ‹æ•°æ®åº“
docker-compose exec backend npx prisma studio
```

---

**æœ€åæ›´æ–°**: 2025-12-15  
**ç»´æŠ¤è€…**: è¿ç»´å›¢é˜Ÿ

