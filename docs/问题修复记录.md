# é—®é¢˜ä¿®å¤è®°å½•

## ä¿®å¤æ—¥æœŸï¼š2024-11-18

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. åˆ›å»ºç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ âœ“

**ä¿®å¤å†…å®¹**ï¼š
- âœ… åˆ›å»º `game-ai/.env.example`
- âœ… åˆ›å»º `game-ai/backend/.env.example`
- âœ… åˆ›å»º `game-ai/player-app/.env.example`
- âœ… åˆ›å»º `game-ai/admin-portal/.env.example`
- âœ… åˆ›å»º `game-ai/player-app/.env`
- âœ… åˆ›å»º `game-ai/admin-portal/.env`

**å½±å“**ï¼š
- æ–°å¼€å‘è€…å¯ä»¥å¿«é€Ÿäº†è§£éœ€è¦é…ç½®çš„ç¯å¢ƒå˜é‡
- é¿å…é…ç½®é”™è¯¯

---

### 2. ä¿®å¤æ•°æ®åº“ç«¯å£é…ç½® âœ“

**ä¿®å¤å†…å®¹**ï¼š
- âœ… ç»Ÿä¸€ä½¿ç”¨ Docker å®¹å™¨ `game-ai-cs-postgres`ï¼ˆç«¯å£ 5432ï¼‰
- âœ… æ›´æ–° `.env` æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- âœ… ç§»é™¤æ•æ„Ÿä¿¡æ¯ï¼ˆé˜¿é‡Œäº‘ OSS å¯†é’¥ï¼‰

**ä¿®å¤å‰**ï¼š
```env
DATABASE_URL="postgresql://cs_app:K7#mP9qL2vNx8rT!wZ@localhost:5433/cs_prod_db?schema=public"
```

**ä¿®å¤å**ï¼š
```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/game_ai_cs?schema=public"
```

---

### 3. ç»Ÿä¸€ä¾èµ–ç‰ˆæœ¬ âœ“

**ä¿®å¤å†…å®¹**ï¼š
- âœ… `@types/uuid`: ç»Ÿä¸€ä½¿ç”¨ `^10.0.0`
- âœ… `bcrypt`: ç»Ÿä¸€ä½¿ç”¨ `^5.1.1`
- âœ… `@types/bcrypt`: ç»Ÿä¸€ä½¿ç”¨ `^5.0.2`
- âœ… `typescript`: ç»Ÿä¸€ä½¿ç”¨ `~5.9.3`

**ä¿®å¤çš„æ–‡ä»¶**ï¼š
- `game-ai/package.json`
- `game-ai/backend/package.json`

---

### 4. æ·»åŠ ç¯å¢ƒå˜é‡éªŒè¯ âœ“

**ä¿®å¤å†…å®¹**ï¼š
- âœ… åˆ›å»º `backend/src/common/config/env.validation.ts`
- âœ… åœ¨ `app.module.ts` ä¸­é›†æˆéªŒè¯
- âœ… åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡

**éªŒè¯çš„ç¯å¢ƒå˜é‡**ï¼š
- `DATABASE_URL` (å¿…éœ€)
- `JWT_SECRET` (å¿…éœ€)
- `JWT_EXPIRES_IN` (å¯é€‰)
- `PORT` (å¯é€‰)
- `NODE_ENV` (å¯é€‰)
- `FRONTEND_URL` (å¯é€‰)
- `REDIS_URL` (å¯é€‰)
- `UPLOAD_DIR` (å¯é€‰)
- `MAX_FILE_SIZE` (å¯é€‰)

---

### 5. æ¸…ç†å†—ä½™ Docker å®¹å™¨ âœ“

**ä¿®å¤å†…å®¹**ï¼š
- âœ… åœæ­¢å¹¶åˆ é™¤å†—ä½™çš„ Redis å®¹å™¨ `game_cs_redis`

**å½“å‰è¿è¡Œçš„å®¹å™¨**ï¼š
- `game-ai-cs-postgres` (PostgreSQL 14, ç«¯å£ 5432)
- `game-ai-cs-redis` (Redis 7, ç«¯å£ 6379)
- `postgres-cs-prod` (PostgreSQL 16, ç«¯å£ 5433) - ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“

---

### 6. æ›´æ–° README æ–‡æ¡£ âœ“

**ä¿®å¤å†…å®¹**ï¼š
- âœ… æ·»åŠ ç¯å¢ƒå˜é‡é…ç½®æ­¥éª¤
- âœ… æ›´æ–°å¿«é€Ÿå¼€å§‹æŒ‡å—
- âœ… æ·»åŠ é‡è¦æç¤º

---

## â³ å¾…ä¿®å¤çš„é—®é¢˜

### 1. å®ç°å·¥å•æ¶ˆæ¯åŠ è½½åŠŸèƒ½

**é—®é¢˜æè¿°**ï¼š
- `player-app/src/pages/TicketChat/index.tsx:28` å­˜åœ¨ TODO
- å·¥å•èŠå¤©é¡µé¢æ— æ³•åŠ è½½å†å²æ¶ˆæ¯

**ä¿®å¤è®¡åˆ’**ï¼š
1. æ£€æŸ¥åç«¯ API æ˜¯å¦å·²å®ç°
2. åœ¨å‰ç«¯å®ç°æ¶ˆæ¯åŠ è½½é€»è¾‘
3. æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

**é¢„è®¡å·¥ä½œé‡**ï¼š2-4 å°æ—¶

---

### 2. å¯ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼

**é—®é¢˜æè¿°**ï¼š
- åç«¯ `tsconfig.json` å…³é—­äº†å¤šé¡¹ä¸¥æ ¼æ£€æŸ¥
- å¯èƒ½éšè—ç±»å‹é”™è¯¯

**ä¿®å¤è®¡åˆ’**ï¼š
1. æ›´æ–° `tsconfig.json` å¯ç”¨ä¸¥æ ¼æ¨¡å¼
2. è¿è¡Œç¼–è¯‘æ£€æŸ¥é”™è¯¯
3. é€æ­¥ä¿®å¤ç±»å‹é—®é¢˜

**é¢„è®¡å·¥ä½œé‡**ï¼š4-8 å°æ—¶

---

### 3. å†³å®š Redis çš„å»ç•™

**é—®é¢˜æè¿°**ï¼š
- Docker ä¸­å¯åŠ¨äº† Redisï¼Œä½†åç«¯ä»£ç æ²¡æœ‰ä½¿ç”¨
- èµ„æºæµªè´¹

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
- **é€‰é¡¹ A**ï¼šç§»é™¤ Redis é…ç½®ï¼ˆå¦‚æœç¡®å®šä¸éœ€è¦ï¼‰
- **é€‰é¡¹ B**ï¼šå®ç° Redis åŠŸèƒ½ï¼ˆå¦‚æœéœ€è¦å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼‰

**é¢„è®¡å·¥ä½œé‡**ï¼š
- ç§»é™¤é…ç½®ï¼š30 åˆ†é’Ÿ
- å®ç°åŠŸèƒ½ï¼š4-8 å°æ—¶

---

### 4. æ”¹è¿›é”™è¯¯å¤„ç†

**é—®é¢˜æè¿°**ï¼š
- éƒ¨åˆ†å¼‚æ­¥æ“ä½œç¼ºå°‘å®Œæ•´çš„é”™è¯¯å¤„ç†
- æŸäº›åœ°æ–¹ä½¿ç”¨ `console.error` è€Œä¸æ˜¯ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ

**ä¿®å¤è®¡åˆ’**ï¼š
1. è¯„ä¼°ç°æœ‰é”™è¯¯å¤„ç†æœºåˆ¶
2. åˆ¶å®šé”™è¯¯å¤„ç†è§„èŒƒ
3. é€æ­¥æ”¹è¿›é”™è¯¯å¤„ç†

**é¢„è®¡å·¥ä½œé‡**ï¼š4-6 å°æ—¶

---

### 5. å¤„ç†ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“

**é—®é¢˜æè¿°**ï¼š
- æœ‰ä¸¤ä¸ª PostgreSQL å®¹å™¨åœ¨è¿è¡Œ
- `postgres-cs-prod` (ç«¯å£ 5433) æ˜¯ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“
- éœ€è¦ç¡®è®¤æ˜¯å¦éœ€è¦ä¿ç•™

**å»ºè®®**ï¼š
- å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒï¼Œå»ºè®®åœæ­¢ç”Ÿäº§æ•°æ®åº“å®¹å™¨
- å¦‚æœéœ€è¦åŒæ—¶è¿è¡Œï¼Œå»ºè®®æ˜ç¡®åŒºåˆ†ç”¨é€”

---

## ğŸ“ ä¿®å¤åçš„éªŒè¯æ­¥éª¤

### 1. éªŒè¯ç¯å¢ƒå˜é‡é…ç½®

```bash
# æ£€æŸ¥æ˜¯å¦å­˜åœ¨ .env.example æ–‡ä»¶
ls -la .env.example
ls -la backend/.env.example
ls -la player-app/.env.example
ls -la admin-portal/.env.example
```

### 2. éªŒè¯ä¾èµ–ç‰ˆæœ¬

```bash
# æ ¹ç›®å½•
npm list bcrypt @types/bcrypt typescript

# åç«¯
cd backend
npm list @types/uuid
```

### 3. éªŒè¯ç¯å¢ƒå˜é‡éªŒè¯åŠŸèƒ½

```bash
# åˆ é™¤å¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼Œæµ‹è¯•éªŒè¯
cd backend
# ä¸´æ—¶åˆ é™¤ DATABASE_URLï¼Œå¯åŠ¨åº”è¯¥å¤±è´¥
npm run start:dev
```

### 4. éªŒè¯æ•°æ®åº“è¿æ¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
npm run db:studio
```

### 5. éªŒè¯åº”ç”¨å¯åŠ¨

```bash
# åç«¯
cd backend
npm run start:dev

# ç©å®¶ç«¯
cd player-app
npm run dev

# ç®¡ç†ç«¯
cd admin-portal
npm run dev
```

---

## ğŸ”§ ä½¿ç”¨æ–°é…ç½®çš„æ­¥éª¤

### æ–°å¼€å‘è€…ä¸Šæ‰‹æµç¨‹

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd game-ai-cs
```

2. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
cp backend/.env.example backend/.env
cp player-app/.env.example player-app/.env
cp admin-portal/.env.example admin-portal/.env
```

3. **ç¼–è¾‘ç¯å¢ƒå˜é‡**
- æ‰“å¼€ `.env` å’Œ `backend/.env`
- æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹é…ç½®

4. **å®‰è£…ä¾èµ–**
```bash
npm install
cd backend && npm install
cd ../player-app && npm install
cd ../admin-portal && npm install
```

5. **å¯åŠ¨æ•°æ®åº“**
```bash
npm run docker:up
```

6. **åˆå§‹åŒ–æ•°æ®åº“**
```bash
npm run db:generate
npm run db:migrate
npm run db:seed
```

7. **å¯åŠ¨æœåŠ¡**
```bash
# åç«¯
cd backend
npm run start:dev

# ç©å®¶ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd player-app
npm run dev

# ç®¡ç†ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd admin-portal
npm run dev
```

---

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

- **å·²ä¿®å¤é—®é¢˜**ï¼š6 ä¸ª
- **å¾…ä¿®å¤é—®é¢˜**ï¼š5 ä¸ª
- **ä¿®å¤æ—¶é—´**ï¼šçº¦ 2 å°æ—¶
- **ä¸‹æ¬¡ä¿®å¤è®¡åˆ’**ï¼šæœ¬å‘¨å†…å®Œæˆå·¥å•æ¶ˆæ¯åŠ è½½åŠŸèƒ½

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®å®Œå–„è®¡åˆ’](./é¡¹ç›®å®Œå–„è®¡åˆ’.md)
- [README.md](../README.md)
- [æŠ€æœ¯æ–‡æ¡£](./æŠ€æœ¯æ–‡æ¡£.md)

---

**æœ€åæ›´æ–°**ï¼š2024-11-18
