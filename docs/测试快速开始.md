# 测试快速开始指南

## 快速开始

### 1. 后端测试

```bash
# 进入后端目录
cd backend

# 运行所有测试
npm test

# 监听模式（开发时推荐）
npm run test:watch

# 生成覆盖率报告
npm run test:cov

# 运行 E2E 测试
npm run test:e2e
```

### 2. 前端测试（需要先安装依赖）

```bash
# 管理端
cd admin-portal
npm install -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom @vitest/ui @vitest/coverage-v8
npm test

# 玩家端
cd player-app
npm install -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom @vitest/ui @vitest/coverage-v8
npm test
```

### 3. 运行所有测试

```bash
# Linux/Mac
./scripts/run-all-tests.sh

# Windows PowerShell
.\scripts\run-all-tests.ps1
```

## 测试文件结构

```
backend/
├── src/
│   ├── auth/
│   │   └── auth.service.spec.ts      # 单元测试
│   └── common/
│       └── logger/
│           └── logger.service.spec.ts # 单元测试
└── test/
    ├── setup.ts                       # E2E 测试配置
    └── app.e2e-spec.ts                # E2E 测试

admin-portal/
├── src/
│   ├── test/
│   │   └── setup.ts                   # 测试配置
│   └── components/
│       └── QuickReplyDrawer/
│           └── QuickReplyDrawer.test.tsx  # 组件测试
└── vitest.config.ts                   # Vitest 配置

player-app/
├── src/
│   └── test/
│       └── setup.ts                   # 测试配置
└── vitest.config.ts                   # Vitest 配置
```

## 查看测试覆盖率

### 后端
```bash
cd backend
npm run test:cov
# 打开 coverage/lcov-report/index.html
```

### 前端
```bash
cd admin-portal  # 或 player-app
npm run test:coverage
# 打开 coverage/index.html
```

## 编写测试示例

### 后端服务测试

```typescript
import { Test, TestingModule } from '@nestjs/testing';
import { YourService } from './your.service';

describe('YourService', () => {
  let service: YourService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [YourService],
    }).compile();

    service = module.get<YourService>(YourService);
  });

  it('应该做某事', () => {
    const result = service.method('input');
    expect(result).toBe('expected');
  });
});
```

### 前端组件测试

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { YourComponent } from './YourComponent';

describe('YourComponent', () => {
  it('应该渲染组件', () => {
    render(<YourComponent />);
    expect(screen.getByText('Hello')).toBeInTheDocument();
  });

  it('应该处理点击事件', () => {
    const handleClick = vi.fn();
    render(<YourComponent onClick={handleClick} />);
    
    fireEvent.click(screen.getByRole('button'));
    expect(handleClick).toHaveBeenCalled();
  });
});
```

## 常见问题

### 1. 测试找不到模块
```bash
# 重新安装依赖
npm install
```

### 2. 测试超时
```typescript
// 在测试文件中增加超时时间
jest.setTimeout(10000);
```

### 3. Mock 不生效
确保在 `beforeEach` 中重置 mock：
```typescript
beforeEach(() => {
  jest.clearAllMocks();
});
```

## 下一步

1. 查看 [系统测试指南](./系统测试指南.md) 了解详细测试方法
2. 查看 [测试实施计划](./测试实施计划.md) 了解测试优先级
3. 开始编写测试文件

