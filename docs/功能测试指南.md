# 问题类型功能测试指南

## 🎉 功能已完成并上线

所有服务已成功启动并运行：

- ✅ **后端服务**: http://localhost:3000
- ✅ **玩家端**: http://localhost:5173
- ✅ **管理端**: http://localhost:5175

---

## 📋 已实现的功能

### 1. 数据库层面
- ✅ 新增 `IssueType` 表（问题类型）
- ✅ 新增 `TicketIssueType` 表（工单-问题类型关联）
- ✅ 修改 `Ticket` 表（添加 `priorityScore` 字段）
- ✅ 预设 12 种常见问题类型

### 2. 后端 API
- ✅ `GET /api/v1/issue-types` - 获取启用的问题类型（公开接口）
- ✅ `GET /api/v1/issue-types/all` - 获取所有问题类型（管理员）
- ✅ `POST /api/v1/issue-types` - 创建问题类型（管理员）
- ✅ `PUT /api/v1/issue-types/:id` - 更新问题类型（管理员）
- ✅ `PATCH /api/v1/issue-types/:id/toggle` - 启用/禁用（管理员）
- ✅ `DELETE /api/v1/issue-types/:id` - 删除问题类型（管理员）
- ✅ 优先级自动计算服务
- ✅ 工单创建时关联问题类型

### 3. 前端功能
- ✅ 玩家端：问题类型多选（卡片式设计）
- ✅ 玩家端：实时加载启用的问题类型
- ✅ 玩家端：提交时包含选择的问题类型

---

## 🧪 测试步骤

### 测试 1：验证问题类型 API

```bash
# 获取所有启用的问题类型
curl http://localhost:3000/api/v1/issue-types
```

**预期结果**：返回 12 种问题类型的 JSON 数据

```json
{
  "success": true,
  "data": [
    {
      "id": "issue-type-01",
      "name": "充值未到账",
      "description": "充值后长时间未到账",
      "priorityWeight": 95,
      "icon": "💰",
      "sortOrder": 1
    },
    // ... 其他 11 种问题类型
  ]
}
```

---

### 测试 2：玩家端完整流程

#### 步骤 1：访问玩家端
1. 打开浏览器访问：http://localhost:5173
2. 应该看到身份验证页面

#### 步骤 2：完成身份验证
1. 选择游戏
2. 选择区服
3. 输入玩家 ID 或昵称
4. 点击"下一步"

#### 步骤 3：填写反馈表单
1. **问题类型选择**（新功能）：
   - 应该看到 12 个问题类型卡片
   - 每个卡片显示图标、名称和描述
   - 可以多选（至少选择一个）
   - 选中的卡片会有蓝色边框

2. **问题描述**：
   - 输入详细的问题描述

3. **其他信息**（可选）：
   - 问题发生时间
   - 问题截图
   - 充值订单号

4. 点击"提交并开始咨询"

#### 步骤 4：验证工单创建
- 应该成功创建工单
- 自动跳转到聊天页面

---

### 测试 3：验证优先级计算

使用 API 测试工具（如 Postman）或 curl 创建工单：

```bash
curl -X POST http://localhost:3000/api/v1/tickets \
  -H "Content-Type: application/json" \
  -d '{
    "gameId": "游戏ID",
    "playerIdOrName": "测试玩家",
    "description": "测试问题",
    "issueTypeIds": ["issue-type-01", "issue-type-02"]
  }'
```

**预期结果**：
- 工单创建成功
- 优先级分数应该是：95 + (90 × 0.3) = 122
- 优先级等级应该是：HIGH

---

### 测试 4：验证数据库数据

```sql
-- 查看问题类型
SELECT * FROM "IssueType" ORDER BY "sortOrder";

-- 查看工单及其问题类型
SELECT 
  t."ticketNo",
  t."priority",
  t."priorityScore",
  it."name" as "issueType"
FROM "Ticket" t
LEFT JOIN "TicketIssueType" tit ON t."id" = tit."ticketId"
LEFT JOIN "IssueType" it ON tit."issueTypeId" = it."id"
ORDER BY t."createdAt" DESC;
```

---

## 📊 预设问题类型列表

| 序号 | 问题类型 | 优先级权重 | 图标 | 描述 |
|------|---------|-----------|------|------|
| 1 | 充值未到账 | 95 | 💰 | 充值后长时间未到账 |
| 2 | 账号被盗 | 90 | 🔒 | 账号被他人登录或盗用 |
| 3 | 游戏无法登录 | 85 | 🚫 | 无法正常登录游戏 |
| 4 | 账号封禁申诉 | 80 | 🔓 | 账号被封禁，申请解封 |
| 5 | 道具丢失 | 75 | 📦 | 游戏内道具或装备丢失 |
| 6 | 游戏闪退/卡顿 | 70 | ⚠️ | 游戏运行不稳定 |
| 7 | 游戏BUG | 65 | 🐛 | 游戏功能异常或BUG |
| 8 | 活动奖励问题 | 60 | 🎁 | 活动奖励未发放或错误 |
| 9 | 实名认证问题 | 55 | 📝 | 实名认证相关问题 |
| 10 | 其他问题 | 50 | 📌 | 其他未分类问题 |
| 11 | 好友/社交问题 | 40 | 👥 | 好友系统、聊天等社交功能 |
| 12 | 游戏玩法咨询 | 30 | ❓ | 游戏玩法、攻略咨询 |

---

## 🎯 优先级计算规则

### 计算公式
```
优先级分数 = 最高权重 + (其他权重之和 × 0.3)
```

### 示例

**示例 1**：选择"充值未到账(95)"
- 优先级分数 = 95
- 优先级等级 = NORMAL

**示例 2**：选择"充值未到账(95) + 账号被盗(90)"
- 优先级分数 = 95 + (90 × 0.3) = 122
- 优先级等级 = HIGH

**示例 3**：选择"充值未到账(95) + 账号被盗(90) + 游戏无法登录(85)"
- 优先级分数 = 95 + ((90 + 85) × 0.3) = 147.5 ≈ 148
- 优先级等级 = HIGH

**示例 4**：选择"充值未到账(95) + 账号被盗(90) + 游戏无法登录(85) + 账号封禁申诉(80)"
- 优先级分数 = 95 + ((90 + 85 + 80) × 0.3) = 171.5 ≈ 172
- 优先级等级 = URGENT

### 优先级等级映射

| 分数范围 | 优先级等级 |
|---------|-----------|
| ≥ 150 | URGENT（紧急）|
| 100-149 | HIGH（高）|
| 60-99 | NORMAL（普通）|
| < 60 | LOW（低）|

---

## 🐛 已知问题

### 浏览器控制台警告
- React Router 的 Future Flag 警告（不影响功能）
- 浏览器插件（淘宝图搜）的网络错误（不影响功能）

这些都是正常的开发环境警告，不影响应用功能。

---

## ✅ 验证清单

测试完成后，请确认以下内容：

- [ ] 问题类型 API 返回正确数据
- [ ] 玩家端可以看到 12 种问题类型
- [ ] 可以多选问题类型
- [ ] 至少选择一个问题类型才能提交
- [ ] 工单创建成功
- [ ] 优先级分数计算正确
- [ ] 数据库中正确保存了问题类型关联

---

## 📝 后续开发建议

### 管理端功能（未实现）
1. 问题类型管理页面
2. 工单列表显示问题类型标签
3. 工单详情显示优先级信息
4. 状态管理按钮（标记已解决/待处理）

### 优化建议
1. 添加问题类型搜索功能
2. 添加问题类型统计分析
3. 支持问题类型的拖拽排序
4. AI 智能推荐问题类型

---

## 🎊 总结

问题类型功能已成功实现并上线！

**核心功能**：
- ✅ 12 种预设问题类型
- ✅ 多选问题类型
- ✅ 智能优先级计算
- ✅ 完整的后端 API
- ✅ 友好的前端交互

**服务状态**：
- ✅ 后端：http://localhost:3000
- ✅ 玩家端：http://localhost:5173
- ✅ 管理端：http://localhost:5175

所有服务运行正常，可以开始测试！🚀
