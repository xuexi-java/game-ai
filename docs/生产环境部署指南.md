# AIå®¢æœç³»ç»Ÿ - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
2. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
3. [æ•°æ®åº“é…ç½®](#æ•°æ®åº“é…ç½®)
4. [åç«¯éƒ¨ç½²](#åç«¯éƒ¨ç½²)
5. [å‰ç«¯éƒ¨ç½²](#å‰ç«¯éƒ¨ç½²)
6. [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
7. [æ•°æ®åº“è¿ç§»](#æ•°æ®åº“è¿ç§»)
8. [æœåŠ¡å¯åŠ¨](#æœåŠ¡å¯åŠ¨)
9. [Nginxé…ç½®](#nginxé…ç½®)
10. [ç›‘æ§å’Œæ—¥å¿—](#ç›‘æ§å’Œæ—¥å¿—)
11. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)
12. [å¤‡ä»½å’Œæ¢å¤](#å¤‡ä»½å’Œæ¢å¤)

---

## ç³»ç»Ÿè¦æ±‚

### æœåŠ¡å™¨è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+ / CentOS 7+) æˆ– Windows Server
- **CPU**: è‡³å°‘ 2 æ ¸
- **å†…å­˜**: è‡³å°‘ 4GB RAM (æ¨è 8GB+)
- **ç£ç›˜**: è‡³å°‘ 50GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: ç¨³å®šçš„ç½‘ç»œè¿æ¥

### è½¯ä»¶è¦æ±‚

- **Node.js**: 20.19.5 (LTSç‰ˆæœ¬)
- **PostgreSQL**: 14+ 
- **Nginx**: 1.18+ (ç”¨äºåå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡)
- **PM2**: ç”¨äºè¿›ç¨‹ç®¡ç† (å¯é€‰ï¼Œæ¨è)
- **Git**: ç”¨äºä»£ç æ‹‰å–

---

## ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£… Node.js

```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# CentOS/RHEL
curl -fsSL https://rpm.nodesource.com/setup_20.x | sudo bash -
sudo yum install -y nodejs

# éªŒè¯å®‰è£…
node -v  # åº”æ˜¾ç¤º v20.19.5
npm -v
```

### 2. å®‰è£… PostgreSQL

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y postgresql postgresql-contrib

# CentOS/RHEL
sudo yum install -y postgresql-server postgresql-contrib
sudo postgresql-setup --initdb
sudo systemctl enable postgresql
sudo systemctl start postgresql

# éªŒè¯å®‰è£…
psql --version
```

### 3. å®‰è£… Nginx

```bash
# Ubuntu/Debian
sudo apt-get install -y nginx

# CentOS/RHEL
sudo yum install -y nginx

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 4. å®‰è£… PM2 (æ¨è)

```bash
sudo npm install -g pm2
```

---

## æ•°æ®åº“é…ç½®

### 1. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

```bash
# åˆ‡æ¢åˆ° postgres ç”¨æˆ·
sudo -u postgres psql

# åœ¨ PostgreSQL ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤
CREATE DATABASE game_ai_cs;
CREATE USER game_ai_user WITH PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE game_ai_cs TO game_ai_user;
ALTER DATABASE game_ai_cs OWNER TO game_ai_user;
\q
```

### 2. é…ç½® PostgreSQL è¿æ¥

ç¼–è¾‘ PostgreSQL é…ç½®æ–‡ä»¶ï¼š

```bash
# Ubuntu/Debian
sudo nano /etc/postgresql/14/main/postgresql.conf

# CentOS/RHEL
sudo nano /var/lib/pgsql/data/postgresql.conf
```

ç¡®ä¿ä»¥ä¸‹é…ç½®ï¼š

```conf
listen_addresses = '*'
port = 5432
```

é…ç½®è®¿é—®æƒé™ï¼š

```bash
# Ubuntu/Debian
sudo nano /etc/postgresql/14/main/pg_hba.conf

# CentOS/RHEL
sudo nano /var/lib/pgsql/data/pg_hba.conf
```

æ·»åŠ ä»¥ä¸‹è¡Œï¼š

```
host    game_ai_cs    game_ai_user    0.0.0.0/0    md5
```

é‡å¯ PostgreSQLï¼š

```bash
sudo systemctl restart postgresql
```

---

## åç«¯éƒ¨ç½²

### 1. å…‹éš†ä»£ç 

```bash
cd /opt
sudo git clone https://github.com/xuexi-java/game-ai.git
sudo chown -R $USER:$USER game-ai
cd game-ai/backend
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install --production
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd /opt/game-ai/backend
cp .env.example .env  # å¦‚æœæœ‰ç¤ºä¾‹æ–‡ä»¶
nano .env
```

é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://game_ai_user:your_secure_password@localhost:5432/game_ai_cs?schema=public"

# JWTé…ç½®
JWT_SECRET="your_very_secure_jwt_secret_key_min_32_chars"
JWT_EXPIRES_IN="7d"

# æœåŠ¡å™¨é…ç½®
PORT=21001
NODE_ENV=production
HOST=your-domain.com

# å‰ç«¯URL (CORSé…ç½®)
FRONTEND_URL="https://admin.your-domain.com,https://player.your-domain.com"

# æ–‡ä»¶ä¸Šä¼ é…ç½®
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE=10485760

# Redisé…ç½® (å¯é€‰)
REDIS_URL="redis://localhost:6379"
```

### 4. æ„å»ºé¡¹ç›®

```bash
npm run build
```

### 5. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
# ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
npx prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma migrate deploy

# å¯é€‰ï¼šè¿è¡Œç§å­æ•°æ®
npx prisma db seed
```

### 6. åˆ›å»ºä¸Šä¼ ç›®å½•

```bash
mkdir -p uploads
chmod 755 uploads
```

---

## å‰ç«¯éƒ¨ç½²

### 1. ç®¡ç†å‘˜é—¨æˆ·éƒ¨ç½²

```bash
cd /opt/game-ai/admin-portal

# å®‰è£…ä¾èµ–
npm install --production

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºäº§ç‰©åœ¨ dist/ ç›®å½•
```

### 2. ç©å®¶ç«¯éƒ¨ç½²

```bash
cd /opt/game-ai/player-app

# å®‰è£…ä¾èµ–
npm install --production

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºäº§ç‰©åœ¨ dist/ ç›®å½•
```

---

## ç¯å¢ƒå˜é‡é…ç½®

### å‰ç«¯ç¯å¢ƒå˜é‡

å‰ç«¯é¡¹ç›®éœ€è¦åœ¨æ„å»ºæ—¶é…ç½® API åœ°å€ã€‚ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

**admin-portal/src/config/api.ts** å’Œ **player-app/src/config/api.ts**

ç¡®ä¿ API_BASE_URL æŒ‡å‘ç”Ÿäº§ç¯å¢ƒåç«¯åœ°å€ï¼š

```typescript
export const API_BASE_URL = 'https://api.your-domain.com/api/v1';
```

æˆ–è€…åœ¨æ„å»ºæ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
# ç®¡ç†å‘˜é—¨æˆ·
cd admin-portal
VITE_API_BASE_URL=https://api.your-domain.com/api/v1 npm run build

# ç©å®¶ç«¯
cd player-app
VITE_API_BASE_URL=https://api.your-domain.com/api/v1 npm run build
```

---

## æ•°æ®åº“è¿ç§»

### ç”Ÿäº§ç¯å¢ƒè¿ç§»

```bash
cd /opt/game-ai/backend

# ä½¿ç”¨ deploy å‘½ä»¤ï¼ˆä¸ä¼šåˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶ï¼Œåªåº”ç”¨ç°æœ‰è¿ç§»ï¼‰
npx prisma migrate deploy

# éªŒè¯æ•°æ®åº“è¿æ¥
npx prisma db pull
```

### è¿ç§»å›æ»š

å¦‚æœéœ€è¦å›æ»šè¿ç§»ï¼š

```bash
# æŸ¥çœ‹è¿ç§»å†å²
npx prisma migrate status

# æ‰‹åŠ¨å›æ»šï¼ˆéœ€è¦è°¨æ…æ“ä½œï¼‰
# è¿æ¥åˆ°æ•°æ®åº“å¹¶æ‰‹åŠ¨åˆ é™¤ç›¸å…³è¡¨æˆ–æ•°æ®
```

---

## æœåŠ¡å¯åŠ¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ PM2 (æ¨è)

#### 1. åˆ›å»º PM2 é…ç½®æ–‡ä»¶

åˆ›å»º `ecosystem.config.js`ï¼š

```javascript
module.exports = {
  apps: [
    {
      name: 'game-ai-backend',
      script: './dist/main.js',
      cwd: '/opt/game-ai/backend',
      instances: 2, // æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´
      exec_mode: 'cluster',
      env: {
        NODE_ENV: 'production',
        PORT: 21001,
      },
      error_file: './logs/pm2-error.log',
      out_file: './logs/pm2-out.log',
      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
      merge_logs: true,
      autorestart: true,
      max_restarts: 10,
      min_uptime: '10s',
      max_memory_restart: '1G',
    },
  ],
};
```

#### 2. å¯åŠ¨æœåŠ¡

```bash
cd /opt/game-ai/backend
pm2 start ecosystem.config.js

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

#### 3. PM2 å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs game-ai-backend

# é‡å¯æœåŠ¡
pm2 restart game-ai-backend

# åœæ­¢æœåŠ¡
pm2 stop game-ai-backend

# åˆ é™¤æœåŠ¡
pm2 delete game-ai-backend

# ç›‘æ§
pm2 monit
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ systemd

#### 1. åˆ›å»º systemd æœåŠ¡æ–‡ä»¶

```bash
sudo nano /etc/systemd/system/game-ai-backend.service
```

å†…å®¹ï¼š

```ini
[Unit]
Description=Game AI Backend Service
After=network.target postgresql.service

[Service]
Type=simple
User=your-user
WorkingDirectory=/opt/game-ai/backend
ExecStart=/usr/bin/node dist/main.js
Restart=always
RestartSec=10
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=game-ai-backend
Environment=NODE_ENV=production
Environment=PORT=21001

[Install]
WantedBy=multi-user.target
```

#### 2. å¯åŠ¨æœåŠ¡

```bash
sudo systemctl daemon-reload
sudo systemctl enable game-ai-backend
sudo systemctl start game-ai-backend

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status game-ai-backend

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u game-ai-backend -f
```

---

## Nginxé…ç½®

### 1. åç«¯ API é…ç½®

åˆ›å»º Nginx é…ç½®æ–‡ä»¶ï¼š

```bash
sudo nano /etc/nginx/sites-available/game-ai-api
```

å†…å®¹ï¼š

```nginx
upstream backend {
    server localhost:21001;
    # å¦‚æœæœ‰å¤šä¸ªå®ä¾‹ï¼Œå¯ä»¥æ·»åŠ æ›´å¤š
    # server localhost:21002;
}

server {
    listen 80;
    server_name api.your-domain.com;

    # é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name api.your-domain.com;

    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /path/to/ssl/cert.pem;
    ssl_certificate_key /path/to/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # æ—¥å¿—
    access_log /var/log/nginx/game-ai-api-access.log;
    error_log /var/log/nginx/game-ai-api-error.log;

    # å®¢æˆ·ç«¯æœ€å¤§è¯·æ±‚ä½“å¤§å°
    client_max_body_size 10M;

    # API ä»£ç†
    location /api/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # WebSocket æ”¯æŒ
    location /socket.io/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket è¶…æ—¶è®¾ç½®
        proxy_read_timeout 86400;
    }

    # æ–‡ä»¶ä¸Šä¼ 
    location /uploads/ {
        alias /opt/game-ai/backend/uploads/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

### 2. ç®¡ç†å‘˜é—¨æˆ·é…ç½®

```bash
sudo nano /etc/nginx/sites-available/game-ai-admin
```

å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name admin.your-domain.com;

    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name admin.your-domain.com;

    ssl_certificate /path/to/ssl/cert.pem;
    ssl_certificate_key /path/to/ssl/key.pem;

    root /opt/game-ai/admin-portal/dist;
    index index.html;

    access_log /var/log/nginx/game-ai-admin-access.log;
    error_log /var/log/nginx/game-ai-admin-error.log;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;

    # API ä»£ç†
    location /api/ {
        proxy_pass https://api.your-domain.com;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # SPA è·¯ç”±æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

### 3. ç©å®¶ç«¯é…ç½®

```bash
sudo nano /etc/nginx/sites-available/game-ai-player
```

å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name player.your-domain.com;

    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name player.your-domain.com;

    ssl_certificate /path/to/ssl/cert.pem;
    ssl_certificate_key /path/to/ssl/key.pem;

    root /opt/game-ai/player-app/dist;
    index index.html;

    access_log /var/log/nginx/game-ai-player-access.log;
    error_log /var/log/nginx/game-ai-player-error.log;

    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;

    location /api/ {
        proxy_pass https://api.your-domain.com;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

### 4. å¯ç”¨é…ç½®å¹¶é‡å¯ Nginx

```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/game-ai-api /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/game-ai-admin /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/game-ai-player /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ç›‘æ§å’Œæ—¥å¿—

### 1. æ—¥å¿—ä½ç½®

- **åç«¯æ—¥å¿—**: `/opt/game-ai/backend/logs/`
- **Nginx è®¿é—®æ—¥å¿—**: `/var/log/nginx/game-ai-*-access.log`
- **Nginx é”™è¯¯æ—¥å¿—**: `/var/log/nginx/game-ai-*-error.log`
- **PM2 æ—¥å¿—**: `~/.pm2/logs/` (å¦‚æœä½¿ç”¨ PM2)

### 2. æ—¥å¿—è½®è½¬

åˆ›å»º logrotate é…ç½®ï¼š

```bash
sudo nano /etc/logrotate.d/game-ai
```

å†…å®¹ï¼š

```
/opt/game-ai/backend/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 your-user your-group
    sharedscripts
    postrotate
        pm2 reloadLogs || true
    endscript
}
```

### 3. ç›‘æ§å»ºè®®

- ä½¿ç”¨ PM2 ç›‘æ§è¿›ç¨‹çŠ¶æ€
- é…ç½®æœåŠ¡å™¨ç›‘æ§ (å¦‚ Prometheus + Grafana)
- è®¾ç½®å‘Šè­¦ (å¦‚é‚®ä»¶ã€çŸ­ä¿¡)
- å®šæœŸæ£€æŸ¥æ—¥å¿—æ–‡ä»¶å¤§å°

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### 1. åç«¯æœåŠ¡æ— æ³•å¯åŠ¨

**æ£€æŸ¥é¡¹ï¼š**
- ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®
- æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
- ç«¯å£æ˜¯å¦è¢«å ç”¨
- æ—¥å¿—æ–‡ä»¶ä¸­çš„é”™è¯¯ä¿¡æ¯

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulpn | grep 21001

# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /opt/game-ai/backend/logs/backend-*.log

# æµ‹è¯•æ•°æ®åº“è¿æ¥
cd /opt/game-ai/backend
npx prisma db pull
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥é¡¹ï¼š**
- PostgreSQL æœåŠ¡æ˜¯å¦è¿è¡Œ
- æ•°æ®åº“ç”¨æˆ·å’Œå¯†ç æ˜¯å¦æ­£ç¡®
- é˜²ç«å¢™è§„åˆ™æ˜¯å¦å…è®¸è¿æ¥
- `pg_hba.conf` é…ç½®æ˜¯å¦æ­£ç¡®

```bash
# æ£€æŸ¥ PostgreSQL çŠ¶æ€
sudo systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -U game_ai_user -d game_ai_cs -h localhost
```

### 3. å‰ç«¯æ— æ³•è®¿é—®åç«¯ API

**æ£€æŸ¥é¡¹ï¼š**
- Nginx é…ç½®æ˜¯å¦æ­£ç¡®
- CORS é…ç½®æ˜¯å¦æ­£ç¡®
- é˜²ç«å¢™è§„åˆ™
- SSL è¯ä¹¦æ˜¯å¦æœ‰æ•ˆ

```bash
# æµ‹è¯• API è¿æ¥
curl https://api.your-domain.com/api/v1/health

# æ£€æŸ¥ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/game-ai-api-error.log
```

### 4. WebSocket è¿æ¥å¤±è´¥

**æ£€æŸ¥é¡¹ï¼š**
- Nginx WebSocket é…ç½®
- é˜²ç«å¢™è§„åˆ™
- åç«¯ WebSocket æœåŠ¡æ˜¯å¦æ­£å¸¸

```bash
# æ£€æŸ¥ WebSocket è¿æ¥
# ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· Network æ ‡ç­¾æŸ¥çœ‹ WebSocket è¿æ¥çŠ¶æ€
```

### 5. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

**æ£€æŸ¥é¡¹ï¼š**
- ä¸Šä¼ ç›®å½•æƒé™
- `MAX_FILE_SIZE` é…ç½®
- ç£ç›˜ç©ºé—´

```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la /opt/game-ai/backend/uploads/

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

---

## å¤‡ä»½å’Œæ¢å¤

### 1. æ•°æ®åº“å¤‡ä»½

#### è‡ªåŠ¨å¤‡ä»½è„šæœ¬

åˆ›å»ºå¤‡ä»½è„šæœ¬ï¼š

```bash
sudo nano /opt/scripts/backup-db.sh
```

å†…å®¹ï¼š

```bash
#!/bin/bash
BACKUP_DIR="/opt/backups/game-ai"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="game_ai_cs"
DB_USER="game_ai_user"

mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
pg_dump -U $DB_USER -h localhost $DB_NAME | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# åˆ é™¤ 30 å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "db_*.sql.gz" -mtime +30 -delete

echo "Backup completed: db_$DATE.sql.gz"
```

è®¾ç½®æ‰§è¡Œæƒé™ï¼š

```bash
chmod +x /opt/scripts/backup-db.sh
```

#### å®šæ—¶å¤‡ä»½

æ·»åŠ åˆ° crontabï¼š

```bash
crontab -e
```

æ·»åŠ ï¼š

```
# æ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½æ•°æ®åº“
0 2 * * * /opt/scripts/backup-db.sh >> /var/log/db-backup.log 2>&1
```

### 2. æ•°æ®åº“æ¢å¤

```bash
# è§£å‹å¤‡ä»½æ–‡ä»¶
gunzip db_20250101_020000.sql.gz

# æ¢å¤æ•°æ®åº“
psql -U game_ai_user -d game_ai_cs -h localhost < db_20250101_020000.sql
```

### 3. æ–‡ä»¶å¤‡ä»½

```bash
# å¤‡ä»½ä¸Šä¼ æ–‡ä»¶
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz /opt/game-ai/backend/uploads/

# æ¢å¤ä¸Šä¼ æ–‡ä»¶
tar -xzf uploads_backup_20250101.tar.gz -C /
```

---

## å®‰å…¨å»ºè®®

### 1. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu (UFW)
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable

# CentOS (firewalld)
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### 2. SSL è¯ä¹¦

ä½¿ç”¨ Let's Encrypt å…è´¹ SSL è¯ä¹¦ï¼š

```bash
# å®‰è£… Certbot
sudo apt-get install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d api.your-domain.com -d admin.your-domain.com -d player.your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### 3. ç¯å¢ƒå˜é‡å®‰å…¨

- ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
- ä½¿ç”¨å¼ºå¯†ç 
- å®šæœŸè½®æ¢ JWT_SECRET
- é™åˆ¶æ•°æ®åº“ç”¨æˆ·æƒé™

### 4. å®šæœŸæ›´æ–°

```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt-get update && sudo apt-get upgrade

# æ›´æ–° Node.js ä¾èµ–
cd /opt/game-ai/backend
npm audit fix
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

- å®šæœŸæ‰§è¡Œ `VACUUM` å’Œ `ANALYZE`
- æ ¹æ®æŸ¥è¯¢æ¨¡å¼åˆ›å»ºç´¢å¼•
- é…ç½®è¿æ¥æ± å¤§å°

### 2. Nginx ä¼˜åŒ–

- å¯ç”¨ Gzip å‹ç¼©
- é…ç½®é™æ€èµ„æºç¼“å­˜
- ä½¿ç”¨ HTTP/2

### 3. Node.js ä¼˜åŒ–

- ä½¿ç”¨ PM2 é›†ç¾¤æ¨¡å¼
- ç›‘æ§å†…å­˜ä½¿ç”¨
- é…ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´

---

## éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] å‰ç«¯é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] API æ¥å£å¯ä»¥æ­£å¸¸è°ƒç”¨
- [ ] WebSocket è¿æ¥æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] SSL è¯ä¹¦é…ç½®æ­£ç¡®
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] å¤‡ä»½ä»»åŠ¡é…ç½®å®Œæˆ
- [ ] ç›‘æ§å‘Šè­¦é…ç½®å®Œæˆ
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®æ­£ç¡®

---

## è”ç³»æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- æ—¥å¿—æ–‡ä»¶
- GitHub Issues
- æŠ€æœ¯æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2025-01-01
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0

